<!DOCTYPE html>
<html lang="tr" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RKO&RIS KayÄ±t Takibi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            transition: background-color 0.3s, color 0.3s;
            padding-top: 20px;
            padding-bottom: 50px;
        }
        .card {
            margin-bottom: 20px;
            border: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .header-rko { background-color: #2c3e50; color: white; }
        .header-ris { background-color: #27ae60; color: white; }
        .header-teachers { background-color: #8e44ad; color: white; }
        
        .total-row {
            font-weight: bold;
            background-color: rgba(0,0,0,0.05) !important;
        }
        
        [data-bs-theme="dark"] .total-row {
            background-color: rgba(255,255,255,0.1) !important;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="fw-bold mb-0">2026 Spring</h1>
        <button id="themeToggle" class="btn btn-outline-primary">ğŸŒ™ Dark Mod</button>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header header-rko text-center">
                    <h4>Kuran Okulu (RKO)</h4>
                </div>
                <ul class="list-group list-group-flush" id="rko-list">
                    <li class="list-group-item text-center">YÃ¼kleniyor...</li>
                </ul>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card">
                <div class="card-header header-ris text-center">
                    <h4>Ä°slam Okulu (RIS)</h4>
                </div>
                <ul class="list-group list-group-flush" id="ris-list">
                    <li class="list-group-item text-center">YÃ¼kleniyor...</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="row justify-content-center mt-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header header-teachers text-center">
                    <h4>Ã–ÄŸretmen KayÄ±t Durumu</h4>
                </div>
                <div class="card-body p-0">
                    <table class="table table-striped table-hover mb-0 text-center">
                        <thead>
                            <tr>
                                <th class="text-start ps-4">Ã–ÄŸretmen Ä°smi</th>
                                <th>KayÄ±t Durumu (Gel/Top)</th>
                                <th>BaÅŸarÄ± YÃ¼zdesi</th>
                            </tr>
                        </thead>
                        <tbody id="teachers-list">
                            <tr><td colspan="3">Veriler yÃ¼kleniyor...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // 1. Render FonksiyonlarÄ± (Hesaplama Dahil)
    function renderSchoolList(schoolData, elementId) {
    const listContainer = document.getElementById(elementId);
    if (!schoolData) {
        listContainer.innerHTML = '<li class="list-group-item text-danger">Veri bulunamadÄ±</li>';
        return;
    }

    let totalStudents = 0;
    let htmlContent = "";

    schoolData.forEach(program => {
        // 1. Verileri Al
        const totalCount = program.count || 0;     // JSON'daki 'count' (Toplam)
        const newCount = program.new || 0;         // JSON'daki 'new' (Yeni)
        
        // 2. Hesaplma Yap (Eski = Toplam - Yeni)
        // EÄŸer yeni sayÄ±sÄ± toplamdan bÃ¼yÃ¼k girilirse hata olmamasÄ± iÃ§in 0'a eÅŸitle
        let oldCount = totalCount - newCount;
        if (oldCount < 0) oldCount = 0;

        totalStudents += totalCount;

        // 3. YÃ¼zdeleri Hesapla
        let newPercent = totalCount > 0 ? Math.round((newCount / totalCount) * 100) : 0;
        let oldPercent = totalCount > 0 ? Math.round((oldCount / totalCount) * 100) : 0;

        // 4. HTML OluÅŸtur (GÃ¶z yormayan, saÄŸa yaslÄ± tasarÄ±m)
        htmlContent += `
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <span class="fw-medium">${program.name}</span>
                
                <div class="d-flex align-items-center">
                    ${totalCount > 0 ? `
                    <div class="me-3 text-end" style="font-size: 0.7rem; line-height: 1.1; opacity: 0.8;">
                        <div class="text-success" title="Yeni KayÄ±t">
                            Yeni: <strong>${newCount}</strong> <span class="text-muted">(%${newPercent})</span>
                        </div>
                        <div class="text-secondary" title="Devam Eden">
                            Eski: <strong>${oldCount}</strong> <span class="text-muted">(%${oldPercent})</span>
                        </div>
                    </div>
                    ` : ''}

                    <span class="badge bg-primary rounded-pill" style="min-width: 40px;">${totalCount}</span>
                </div>
            </li>
        `;
    });

    // Alt Toplam SatÄ±rÄ±
    htmlContent += `
        <li class="list-group-item d-flex justify-content-between align-items-center total-row">
            TOPLAM Ã–ÄRENCÄ°
            <span class="badge bg-dark rounded-pill" style="min-width: 40px;">${totalStudents}</span>
        </li>
    `;
    listContainer.innerHTML = htmlContent;
}
    function renderTeachersTable(teacherData) {
        const tableBody = document.getElementById('teachers-list');
        if (!teacherData) {
            tableBody.innerHTML = '<tr><td colspan="3" class="text-danger">Veri bulunamadÄ±</td></tr>';
            return;
        }

        let totalArrived = 0;
        let totalPossible = 0;
        let htmlContent = "";

        teacherData.forEach(teacher => {
            totalArrived += teacher.arrived;
            totalPossible += teacher.total;
            
            let percentage = 0;
            if(teacher.total > 0) {
                percentage = ((teacher.arrived / teacher.total) * 100).toFixed(1);
            }

            let badgeColor = percentage < 25 ? 'bg-danger' : (percentage < 50 ? 'bg-warning text-dark' : 'bg-success');

            htmlContent += `
                <tr>
                    <td class="text-start ps-4">${teacher.name}</td>
                    <td>${teacher.arrived} / ${teacher.total}</td>
                    <td>
                        <div class="progress" style="height: 20px;">
                            <div class="progress-bar ${badgeColor}" role="progressbar" style="width: ${percentage}%" aria-valuenow="${percentage}" aria-valuemin="0" aria-valuemax="100">%${percentage}</div>
                        </div>
                    </td>
                </tr>
            `;
        });

        let totalPercentage = 0;
        if (totalPossible > 0) {
            totalPercentage = ((totalArrived / totalPossible) * 100).toFixed(1);
        }

        htmlContent += `
            <tr class="total-row">
                <td class="text-start ps-4">GENEL TOPLAM</td>
                <td><strong>${totalArrived} / ${totalPossible}</strong></td>
                <td><strong>%${totalPercentage}</strong></td>
            </tr>
        `;
        tableBody.innerHTML = htmlContent;
    }

    // 2. Fetch ve BaÅŸlatma
    document.addEventListener('DOMContentLoaded', () => {
        // JSON dosyasÄ±nÄ± Ã§ek
        fetch('./kayit.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP hata: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                renderSchoolList(data.rko, 'rko-list');
                renderSchoolList(data.ris, 'ris-list');
                renderTeachersTable(data.teachers);
            })
            .catch(error => {
                console.error('Veri yÃ¼klenemedi:', error);
                document.getElementById('rko-list').innerHTML = `<li class="list-group-item text-danger">Veri yÃ¼klenemedi: ${error.message}<br><small>Not: Yerel sunucu kullandÄ±ÄŸÄ±nÄ±zdan emin olun.</small></li>`;
            });

        // Dark Mode Logic
        const toggleBtn = document.getElementById('themeToggle');
        const htmlElement = document.documentElement;

        toggleBtn.addEventListener('click', () => {
            const currentTheme = htmlElement.getAttribute('data-bs-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            htmlElement.setAttribute('data-bs-theme', newTheme);
            toggleBtn.textContent = newTheme === 'light' ? 'ğŸŒ™ Dark Mod' : 'â˜€ï¸ Light Mod';
            toggleBtn.classList.toggle('btn-outline-primary');
            toggleBtn.classList.toggle('btn-outline-warning');
        });
    });
</script>

</body>
</html>
